<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promise.prototype.then</title>
  </head>
  <body>
    <pre>
        13、Promise
        概述：
        Promise 是 ES6 引入的异步编程的新解决方案。语法上 Promise 是一个构造函数，用来封装异步操作并可以获取其成功或失败的结果；
        1.	Promise 构造函数: Promise (excutor) {}；
        2.	Promise.prototype.then 方法；
        3.	Promise.prototype.catch 方法；
        
        基本使用：  
        // 创建 Promise 对象
        const p = new Promise((resolve, reject) => {
          setTimeout(() => {
            resolve("用户数据");
          }, 1000);
        });
        // 调用then方法，then方法的返回结果是promise对象，
        // 对象的状态有回调函数的结果决定;
        const result = p.then(
          (value) => {
            console.log(value);
            // 1、如果回调函数中返回的结果是 非promise 类型的数据，
            // 状态为成功，返回值为对象的成功值resolved
            // [[PromiseStatus]]:"resolved"
            // [[PromiseValue]]:123
            // return 123;
            // 2、如果...是promise类型的数据
            // 此Promise对象的状态决定上面Promise对象p的状态
            // return new Promise((resolve,reject)=>{
            //	// resolve("ok"); // resolved
            //	reject("ok"); // rejected
            // });
            // 3、抛出错误
            // throw new Error("失败啦！");
            // 状态：rejected
            // value：失败啦！
          },
          (reason) => {
            console.error(reason);
          }
        );
    
        // 链式调用
        // then里面两个函数参数，可以只写一个p.then(value=>{},reason=>{}).then(value=>{},reason=>{});
        console.log(result);        
    </pre>
  </body>
  <script>
    // 创建 Promise 对象
    const p = new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve("用户数据");
      }, 1000);
    });
    // 调用then方法，then方法的返回结果是promise对象，
    // 对象的状态有回调函数的结果决定;
    const result = p.then(
      (value) => {
        console.log(value);
        // 1、如果回调函数中返回的结果是 非promise 类型的数据，
        // 状态为成功，返回值为对象的成功值resolved
        // [[PromiseStatus]]:"resolved"
        // [[PromiseValue]]:123
        // return 123;
        // 2、如果...是promise类型的数据
        // 此Promise对象的状态决定上面Promise对象p的状态
        // return new Promise((resolve,reject)=>{
        //	// resolve("ok"); // resolved
        //	reject("ok"); // rejected
        // });
        // 3、抛出错误
        // throw new Error("失败啦！");
        // 状态：rejected
        // value：失败啦！
      },
      (reason) => {
        console.error(reason);
      }
    );

    // 链式调用
    // then里面两个函数参数，可以只写一个p.then(value=>{},reason=>{}).then(value=>{},reason=>{});
    console.log(result);
  </script>
</html>
